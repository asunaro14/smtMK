<html>
<head>
  <title>SMT DEMO</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-startup-image" href="/startup.png" media="screen and (orientation:landscape)" />
  <link rel="apple-touch-startup-image" href="/startup.png" media="screen and (orientation:portrait)" />

  <script type="text/javascript" src="../jquery/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" src="js/app.js"></script>
  <script type="text/javascript" src="js/parts.js"></script>
  <script type="text/javascript" src="js/csv.js"></script>
  <script type="text/javascript" src="js/png.js"></script>
  <script type="text/javascript" src="js/resonance.js"></script>
  <script type="text/javascript" src="../jquery/jquery.mobile-1.3.2.min.js"></script>
  <link type="text/css" rel="stylesheet" href="../jquery/jquery.mobile-1.3.2.min.css">
  <link type="text/css" rel="stylesheet" href="themes/smt.css" />
  <link type="text/css" rel="stylesheet" href="css/app.css">
  <!--datebox用のファイル-->
  <link rel="stylesheet" href="datebox/jqm-datebox.css" />
  <script type="text/javascript" src="datebox/jqm-datebox.core.js"></script>
  <script type="text/javascript" src="datebox/jqm-datebox-1.4.0.comp.flipbox.min.js"></script>
  <script type="text/javascript" src="datebox/jquery.mobile.datebox.i18n.ja.utf8.js"></script>
</head>
<body>
  <div data-role="page" id="entry_20">

    <script type="text/javascript">
      // 初期設定
      var entry_20 = {
        title: "退院時報告",
        data: [
            { number: "20-01", title: "記入日", description: "記入日", type: "ID", param: "", value: "today", require: true, enterNext: "20-02" },
            { number: "20-02", title: "登録番号", description: "登録番号", type: "IT", param: "", value: "patientNumber", require: true, enterNext: "20-03" },
            { number: "20-03", title: "術者", description: "術者", type: "IT", param: "", require: true, enterNext: "20-04" },
            { number: "20-04", title: "手術日", description: "手術日", type: "ID", param: "", value: "today", require: true, enterNext: "20-05" },
            { number: "20-05", title: "手術時間", description: "手術時間", type: "IN", param: "min:0,max:200,unit:'分（皮切→縫合終了）'", require: true, enterNext: "20-06" },
            { number: "20-06", title: "術中出血量", description: "術中出血量", type: "IN", param: "min:0,max:5000,unit:'ml'", require: true, enterNext: "20-07" },
            { number: "20-07", title: "皮切長", description: "皮切長", type: "IN", param: "min:0,max:200,unit:'cm'", require: true },
            { number: "20-08", title: "Surgical Approach", description: "Surgical Approach", type: "SV", options: "メディアルパラパテラ:メディアルパラパテラ,ミッドバスタス:ミッドバスタス,サブバスタス:サブバスタス,ミニミッドバスタス:ミニミッドバスタス,ミニサブバスタス:ミニサブバスタス,ミニメディアルパラパテラ:ミニメディアルパラパテラ,トライベクター:トライベクター,その他:その他", require: true },
            { number: "20-09", title: "使用ジグ", description: "使用ジグ", type: "SV", options: "Conventional:Conventional,Computer Navigation:Computer Navigation,PMI:PMI", require: true },
            { number: "20-10", title: "骨切除量計測<br/>（ノギスにて計測）", description: "※ブレードの厚みを1.37mmと仮定し、その厚みを追加した切除量をご記入ください。", type: "DT", param: "", require: true },
            { number: "20-11", title: "大腿骨遠位（内側）", description: "大腿骨遠位（内側）", type: "IN", param: "min:0,max:200,prefix:'内側',unit:'mm'", require: true, enterNext: "20-12" },
            { number: "20-12", title: "大腿骨遠位（外側）", description: "大腿骨遠位（外側）", type: "IN", param: "min:0,max:200,prefix:'外側',unit:'mm'", require: true },
            { mvCount: 2, number: "20-13", title: "大腿骨遠位", description: "大腿骨遠位", type: "MH", options: "1:Measured,2:Gap", require: true },
            { number: "20-14", title: "大腿骨後顆（内側）", description: "大腿骨後顆（内側）", type: "IN", param: "min:0,max:200,prefix:'内側',unit:'mm'", require: true, enterNext: "20-15" },
            { number: "20-15", title: "大腿骨後顆（外側）", description: "大腿骨後顆（外側）", type: "IN", param: "min:0,max:200,prefix:'外側',unit:'mm'", require: true },
            { mvCount: 2, number: "20-16", title: "大腿骨後顆", description: "大腿骨後顆", type: "MH", options: "1:Measured,2:Gap", require: true },
            { number: "20-17", title: "脛骨近位（内側）", description: "脛骨近位（内側）", type: "IN", param: "min:0,max:200,prefix:'内側',unit:'mm'", require: true, enterNext: "20-18" },
            { number: "20-18", title: "脛骨近位（外側）", description: "脛骨近位（外側）", type: "IN", param: "min:0,max:200,prefix:'外側',unit:'mm'", require: true },
            { mvCount: 2, number: "20-19", title: "脛骨近位", description: "脛骨近位", type: "MH", options: "1:Measured,2:Gap", require: true },
            { mvCount: 5, number: "20-20", title: "大腿骨回旋アライメントチェック", description: "大腿骨回旋アライメントチェック", type: "MV", options: "1:Whiteside Line,2:Parallel tibial resection line,3:CEA,4:SEA,5:PCA", require: true },
            { mvCount: 3, number: "20-21a", title: "大腿骨サイジング", description: "大腿骨サイジング", type: "MV", options: "1:Anterior Ref.,2:Posterior Ref.,3:Intermediate Ref.", require: true },
            { mvCount: 2, number: "20-21b", title: "大腿骨サイジング２", description: "大腿骨サイジング", type: "MV", options: "4:Larger Size,5:Smaller Size", require: true },
            { mvCount: 2, number: "20-22", title: "脛骨回旋アライメント指標", description: "脛骨回旋アライメント指標", type: "MV", options: "1:AP axis,2:Akagi's line", require: true },
            { number: "20-23", title: "骨ギャップ計測", description: "", type: "DT", param: "", require: true },
//                    { number: "20-24", title: "伸展Gap", description: "伸展Gap", type: "SH", options:"1:内側,2:外側", require: true },
            { number: "20-25", title: "伸展Gap（内側）", description: "伸展Gap（内側）", type: "IN", param: "min:0,max:200,prefix:'内側',unit:'mm'", require: true, enterNext: "20-26" },
            { number: "20-26", title: "伸展Gap（外側）", description: "伸展Gap（外側）", type: "IN", param: "min:0,max:200,prefix:'外側',unit:'mm'", require: true, enterNext: "20-28" },
//                    { number: "20-27", title: "屈曲Gap", description: "屈曲Gap", type: "SH", options:"1:内側,2:外側", require: true },
            { number: "20-28", title: "屈曲Gap（内側）", description: "屈曲Gap（内側）", type: "IN", param: "min:0,max:200,prefix:'内側',unit:'mm'", require: true, enterNext: "20-29" },
            { number: "20-29", title: "屈曲Gap（外側）", description: "屈曲Gap（外側）", type: "IN", param: "min:0,max:200,prefix:'外側',unit:'mm'", require: true, enterNext: "20-31" },
            { number: "20-30", title: "大腿骨インプラント", description: "", type: "DT", param: "", require: true },
            { number: "20-31", title: "使用機種名", description: "", type: "IT", param: "", require: true },
            { number: "20-32", title: "固定", description: "", type: "SH", options: "セメント:セメント,セメントレス:セメントレス", require: true },
            //{ number: "20-33", title: "タイプ", description: "", type: "SH", options: "BCS:BCS,PS:PS,CR:CR,その他:その他", require: true },
            { number: "20-33", title: "タイプ", description: "", type: "SH", options: "BCS:BCS,PS:PS,CR:CR,その他:その他", require: true, onclick: "entry_20.onClickSH(\"20-33\");" },
            { number: "20-33-else", title: "大腿骨タイプその他", type: "IT" },
            { number: "20-34", title: "材質", description: "", type: "SH", options: "OXINIUM:OXINIUM,CoCr:CoCr,Zirconia ceramic:Zirconia ceramic", require: true },
            { number: "20-35", title: "使用サイズ", description: "", type: "IT", param: "", require: true, enterNext: "20-37" },
            { number: "20-36", title: "脛骨インプラント", description: "", type: "DT", param: "", require: true },
//                    { number: "20-37", title: "使用機種名", description: "", type: "IT", param: "", require: true },
            { number: "20-38", title: "固定", description: "", type: "SH", options: "セメント:セメント,セメントレス:セメントレス", require: true },
            { number: "20-39", title: "ベアリング", description: "", type: "SH", options: "Fixed:Fixed,Mobile:Mobile", require: true },
            //{ number: "20-40", title: "インサート形状", description: "", type: "SH", options: "BCS:BCS,PS:PS,CR:CR,CS:CS,CCK:CCK,BCR:BCR,その他:その他", require: true },
            { number: "20-40", title: "インサート形状", description: "", type: "SH", options: "BCS:BCS,PS:PS,CR:CR,CS:CS,CCK:CCK,BCR:BCR,その他:その他", require: true, onclick: "entry_20.onClickSH(\"20-40\");" },
            { number: "20-40-else", title: "脛骨インサートその他", type: "IT" },
            { number: "20-41", title: "使用サイズ", description: "", type: "IT", param: "", require: true },
            { number: "20-42", title: "膝蓋骨インプラント", description: "", type: "SH", options: "置換:置換,非置換:非置換", require: true }
        ],
        nextPage: "entry_30.html",

        onBeforeShow: function () {
          App.setForm("entry_20");
          $("#item-20-33-else").textinput('disable');
          $("#item-20-40-else").textinput('disable');
          //一時保存のデータもCSV出力をするため、複数選択項目分空白をセットする セットしないとCSV出力時に場所がずれてしまう 20150310　山田
          var comma;
          $.each(entry_20.data, function (i, row) {
            if (row.mvCount) {
              comma = '';
              for (var n = 1; n < row.mvCount; n++) {
                comma += ',';
              }
              entry_20.data[i].ans = entry_20.data[i].ans || comma;//mvCountに含まれている数にカンマで区切る　20150310　山田
              console.log({ mvCount: entry_20.data[i] });
            }
          });
        },

        onShow: function () {
          // その他欄のアクティブ化
          if (App.getRow("20-33").ans == "その他") {
            $("#item-20-33-else").textinput('enable');
          }
          if (App.getRow("20-40").ans == "その他") {
            $("#item-20-40-else").textinput('enable');
          }
        }

      };
      // 「その他」の制御
      entry_20.onClickSH = function (num) {
        // 候補辞書の作成
        var row = App.getRow(num);
        var dic = App.createDictionary(row);
        // チェックされたものが「その他」であるか検査
        var ans = false;
        var val = $("input[name=item-" + num + "]:checked").val();
        if (dic[val] == "その他" || dic[val] == "あり") {
          $("#item-" + num + "-else").textinput('enable');
          $("#item-" + num + "-else").focus();
          setTimeout(function () {
            $("#item-" + num + "-else").focus();
          }, 250);
        } else {
          $("#item-" + num + "-else").val("");
          $("#item-" + num + "-else").textinput('disable');
          $("#item-" + num + "-else").blur();
          App.getAns(num + "-else");
        }
      };
      // 登録処理（必須チェック＆スコア集計）
      entry_20.save = function () {
        App.checkRequire();
      };

      // 確認画面のアクション
      entry_20_onConfirm = function (ans) {
        //$("#entry_20_alert").popup("close");
        App.afterConfirm(ans);
      };

    </script>

    <div data-role="header" data-position="fixed" data-tap-toggle="false">
      <a href='javascript:history.back();' data-rel="button" data-icon="back" class="ui-btn-left">戻る</a>
      <h1 id="entry_20_Title"></h1>
    </div>

    <div data-role="content">
      <table data-role="table" class="appForm ui-body-d ui-shadow ui-responsive" style="width:640px !important;">
        <thead>
          <tr class="ui-bar-d">
            <th class="appFormCol" width="140">患者登録番号</th>
            <th class="appFormCol" width="100">患者ID</th>
            <th class="appFormCol" width="100">イニシャル</th>
            <th class="appFormCol" width="100">性別</th>
            <th class="appFormCol" width="100">患側</th>
          </tr>
        </thead>
        <tbody>
          <tr class="appPatient">
            <td><div id="entry_20_Number" style="word-wrap: break-word; width:140px;"></div></td>
            <td><div id="entry_20_ID" style="word-wrap: break-word; width: 100px;"></div></td>
            <td><div id="entry_20_Initial" style="word-wrap: break-word; width: 100px;"></div></td>
            <td><div id="entry_20_Sex"></div></td>
            <td><div id="entry_20_Side"></div></td>
          </tr>
        </tbody>
      </table>
      <!--
                  <table data-role="table" class="appForm ui-body-d ui-shadow ui-responsive" style="width:640px !important;">
                      <thead>
                          <tr class="ui-bar-d">
                              <th class="appFormCol" width="140">患者登録番号</th>
                              <th class="appFormCol" width="100">患者ID</th>
                              <th class="appFormCol" width="100">イニシャル</th>
                              <th class="appFormCol" width="100">性別</th>
                              <th class="appFormCol" width="100">患側</th>
                          </tr>
                      </thead>
                      <tbody>
                          <tr class="appPatient">
                              <td id="entry_20_Number"></td>
                              <td id="entry_20_ID"></td>
                              <td id="entry_20_Initial"></td>
                              <td id="entry_20_Sex"></td>
                              <td id="entry_20_Side"></td>
                          </tr>
                      </tbody>
                  </table>
      -->
      <br />
      <table data-role="table" class="appForm ui-body-d ui-shadow ui-responsive" data-column-btn-theme="b">
        <thead>
          <tr class="ui-bar-d">
            <th class="appFormCol" width="200">項目</th>
            <th class="appFormCol">内容</th>
          </tr>
        </thead>
        <tbody id="entry_20_answerArea">
          <tr><td id="entry_20_cap20-01">　</td><td class='appLeft' id="entry_20_ans20-01">　</td></tr>
          <tr><td id="entry_20_cap20-02">　</td><td class='appLeft' id="entry_20_ans20-02">　</td></tr>
          <tr><td id="entry_20_cap20-03">　</td><td class='appLeft' id="entry_20_ans20-03">　</td></tr>
          <tr class="ui-bar-d">
            <th colspan="2" class="appFormCol">術中評価</th>
          </tr>
          <tr><td id="entry_20_cap20-04">　</td><td class='appLeft' id="entry_20_ans20-04">　</td></tr>
          <tr><td id="entry_20_cap20-05">　</td><td class='appLeft' id="entry_20_ans20-05">　</td></tr>
          <tr><td id="entry_20_cap20-06">　</td><td class='appLeft' id="entry_20_ans20-06">　</td></tr>
          <tr><td id="entry_20_cap20-07">　</td><td class='appLeft' id="entry_20_ans20-07">　</td></tr>
          <tr><td id="entry_20_cap20-08">　</td><td class='appLeft' id="entry_20_ans20-08">　</td></tr>
          <tr><td id="entry_20_cap20-09">　</td><td class='appLeft' id="entry_20_ans20-09">　</td></tr>
          <tr>
            <td id="entry_20_cap20-10">　</td>
            <td class='appLeft'>
              <div id="entry_20_ans20-10"></div>
              <table class="appInnerTable" style="width:100%;">
                <tbody>
                  <tr><th>大腿骨遠位</th><td id="entry_20_ans20-11"></td><td id="entry_20_ans20-12"></td><td id="entry_20_ans20-13"></td></tr>
                  <tr><th>大腿骨後顆</th><td id="entry_20_ans20-14"></td><td id="entry_20_ans20-15"></td><td id="entry_20_ans20-16"></td></tr>
                  <tr><th>脛骨近位</th><td id="entry_20_ans20-17"></td><td id="entry_20_ans20-18"></td><td id="entry_20_ans20-19"></td></tr>
                </tbody>
              </table>
              <div id="entry_20_ans20-11"></div>
            </td>
          </tr>
          <tr><td id="entry_20_cap20-20">　</td><td class='appLeft' id="entry_20_ans20-20">　</td></tr>
          <tr><td id="entry_20_cap20-21a">　</td><td class='appLeft'><div id="entry_20_ans20-21a">　</div><div id="entry_20_ans20-21b">　</div></td></tr>
          <tr><td id="entry_20_cap20-22">　</td><td class='appLeft' id="entry_20_ans20-22">　</td></tr>
          <tr>
            <td id="entry_20_cap20-23">　</td>
            <td class='appLeft'>
              <table class="appInnerTable" style="width:100%;">
                <tbody>
                  <tr>
                    <th>伸展Gap</th>
                    <!-- <td id="entry_20_ans20-24"></td> -->
                    <td id="entry_20_ans20-25"></td>
                    <td id="entry_20_ans20-26"></td>
                  </tr>
                  <tr>
                    <th>屈曲Gap</th>
                    <!-- <td id="entry_20_ans20-27"></td> -->
                    <td id="entry_20_ans20-28"></td>
                    <td id="entry_20_ans20-29"></td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
          <tr>
            <td id="entry_20_cap20-30">　</td>
            <td class='appLeft'>
              <table class="appInnerTable" style="width:100%;">
                <tbody>
                  <tr><th>使用機種名</th><td id="entry_20_ans20-31" class="appLeft"></td></tr>
                  <tr><th>固定</th><td id="entry_20_ans20-32" class="appLeft"></td></tr>
                  <tr><th>タイプ</th><td id="entry_20_ans20-33" class="appLeft"></td></tr>
                  <tr><th></th><td id="entry_20_ans20-33-else" style="width: 480px; border: none; text-align: left !important;"></td></tr>
                  <tr><th>材質</th><td id="entry_20_ans20-34" class="appLeft"></td></tr>
                  <tr><th>使用サイズ</th><td id="entry_20_ans20-35" class="appLeft"></td></tr>
                </tbody>
              </table>
            </td>
          </tr>
          <tr>
            <td id="entry_20_cap20-36">　</td>
            <td class='appLeft'>
              <table class="appInnerTable" style="width:100%;">
                <tbody>
                  <!--
                  <tr><th>使用機種名</th><td id="entry_20_ans20-37" class="appLeft"></td></tr>
                  -->
                  <tr><th>固定</th><td id="entry_20_ans20-38" class="appLeft"></td></tr>
                  <tr><th>ベアリング</th><td id="entry_20_ans20-39" class="appLeft"></td></tr>
                  <tr><th>インサート形状</th><td id="entry_20_ans20-40" class="appleft"></td></tr>
                  <tr><th></th><td id="entry_20_ans20-40-else" style="width: 480px; border: none; text-align: left !important;"></td></tr>
                  <tr><th>使用サイズ</th><td id="entry_20_ans20-41" class="appLeft"></td></tr>
                </tbody>
              </table>
            </td>
          </tr>
          <tr><td id="entry_20_cap20-42">　</td><td class='appLeft' id="entry_20_ans20-42">　</td></tr>
        </tbody>
      </table>
      <br />
      <fieldset class="ui-grid-b">
        <div class="ui-block-a"></div>
        <div class="ui-block-b"><a href="javascript:entry_20.save();" data-role="button" data-theme="a" data-icon="check" data-iconpos="left">登録</a></div>
        <div class="ui-block-c"></div>
      </fieldset>
    </div>

    <div data-role="popup" id="entry_20_alert" data-dismissible="false" data-theme="d">
      <div data-role="header" data-theme="c">
        <h1 id="entry_20_alertTitle">確認</h1>
      </div>
      <div data-role="content" data-theme="d">
        <p id="entry_20_alertMessage">メッセージ</p>
        <a href="javascript:entry_20_onConfirm(3);" data-role="button" id="entry_20_confirm3" data-theme="a">次のページに進む</a>
        <a href="javascript:entry_20_onConfirm(2);" data-role="button" id="entry_20_confirm2" data-theme="a">メニューに戻る</a>
        <a href="javascript:entry_20_onConfirm(1);" data-role="button" id="entry_20_confirm1" data-theme="a">一時登録してメニューに戻る</a>
        <a href="javascript:entry_20_onConfirm(0);" data-role="button" id="entry_20_confirm0" data-theme="a">キャンセル</a>
        <a href="#" data-role="button" data-rel="back" id="entry_20_confirm" data-theme="a">OK</a>
      </div>
    </div>

  </div>

</body>
</html>
